---
title: "Project"
author: "Mohammed Hussain"
output: 
  html_document:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE, error=FALSE}
library(readxl)
library(tidyverse)
library(factoextra)
library(sf)
library(lwgeom)
library(plotly)
library(leaflet)
```

```{r zip, include=FALSE}
zip_shp <- st_read("C:/Users/amaan/Desktop/Project/GIS/ZIP_Codes_in_Durham_County/ZIP_Codes_in_Durham_County.shp", quiet = TRUE)
zip_shp <- st_transform(zip_shp, 32119)
```
```{r road, include=FALSE}
road_shp <- st_read("C:/Users/amaan/Desktop/Project/GIS/Roads/Roads.shp",quiet = TRUE)
road_shp <- st_transform(road_shp, 32119)
```

![The region of interest mapped in research articles](C:/Users/amaan/Desktop/Project/website/GIS Data & Code/Region.png)

I will map this approximate region using ZIP code region and roads data available on Durham Open Data Portal. The region covers parts of the four ZIP code regions: 27701,27703,27704,27707. The region is bounded by four highways: 15/501,85,885,147.

I ran into a lot of trouble trying to combine roads and cut boundaries with the ZIP code regions. I was trying to make a boundary with the four highways but the individual data points for the roads were numerous to combine into one line string or multi-string. I decided to manually plot four points and connect them as a polygon to mark the region of interest. Then it was easier to intersect the ZIP code regions and roads to focus on the region of interest. I learned that manually plotting points is not uncommon for such a task.

```{r boundaries}
# The boundaries can be manually created using estimated coordinates
cut_poly <- 
  st_polygon(
    list(
      rbind(
        c(-78.90, 36.02),  # NW
        c(-78.86, 36.02),  # NE
        c(-78.86, 35.96),  # SE
        c(-78.90, 35.96),  # SW
        c(-78.90, 36.02)
          )
        )
      )
```


```{r region_map, include=FALSE}

# The region of interest extends into three ZIP code regions
zips_sel <- 
  zip_shp |>
  filter(ZIPCODE %in% c("27701","27703","27704","27707")) |>
  st_transform(32119)
# The region of interest is bordered by four highways
roads_sel <- 
  road_shp |> 
  filter(HWYNUMBER %in% c("15/501","85","885","147")) |>
  st_transform(32119)

# The boundaries can be manually created using estimated coordinates
cut_poly <- st_polygon(list(rbind(
  c(-78.90, 36.02),  # NW
  c(-78.86, 36.02),  # NE
  c(-78.86, 35.96),  # SE
  c(-78.90, 35.96),  # SW
  c(-78.90, 36.02)
)))
cut_poly <- st_sfc(cut_poly, crs = 4326)
cut_poly <- st_transform(cut_poly, st_crs(roads_sel))
# The ZIP regions and roads can be cutoff to focus on the region of interest
zips_cut <- st_intersection(zips_sel, cut_poly)
roads_cut <- st_intersection(roads_sel, cut_poly)

zips_cut    <- st_transform(zips_cut, 4326)
roads_cut  <- st_transform(roads_cut, 4326)
cut_poly  <- st_transform(cut_poly, 4326)

durham <- zip_shp |> filter(CITY == "DURH")
  # # Base region
  # addPolygons(
  #   data = durham,
  #   fillColor = "#e5ecf6",
  #   fillOpacity = 0.6,
  #   color = "#2b2b2b",
  #   weight = 1
  # ) %>%

```


```{r base}

base <- 
  leaflet(options = leafletOptions(preferCanvas = TRUE)) |>
  addProviderTiles(providers$CartoDB.Positron) |>
  # ZIP code regions
  addPolygons(
    data = zips_cut,
    fill = FALSE,
    color = "brown",
    weight = 0.5,
    opacity = 0.6
  ) |>
  # Roads
  addPolylines(
    data = roads_cut,
    color = "black",
    weight = 1,
    opacity = 0.7
  ) |>
  # Region of interest
  addPolygons(
    data = cut_poly,
    fill = FALSE,
    color = "red",
    weight = 2,
    dashArray = "5,5"
  )
base

```
