---
title: "GIS_Project"
author: "Mohammed Hussain"
date: "2025-12-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE, error=FALSE}
library(readxl)
library(tidyverse)
library(factoextra)
library(sf)
library(lwgeom)
library(plotly)
```

Durham map divided into ZIP Code Regions
```{r zip}
zip_shp <- st_read("C:/Users/amaan/Desktop/Project/GIS/ZIP_Codes_in_Durham_County/ZIP_Codes_in_Durham_County.shp", quiet = TRUE)
zip_shp <- st_transform(zip_shp, 32119)
```
Durham map with Roads
```{r road}
road_shp <- st_read("C:/Users/amaan/Desktop/Project/GIS/Roads/Roads.shp",quiet = TRUE)
road_shp <- st_transform(road_shp, 32119)
```

Map the region of interest

```{r map}

# The region of interest extends into three ZIP code regions
zips_sel <- 
  zip_shp |>
  filter(ZIPCODE %in% c("27701","27703","27704","27707")) |>
  st_transform(32119)
# The region of interest is bordered by four highways
roads_sel <- 
  road_shp |> 
  filter(HWYNUMBER %in% c("15/501","85","885","147")) |>
  st_transform(32119)

# The boundaries can be manually created using estimated coordinates
cut_poly <- st_polygon(list(rbind(
  c(-78.90, 36.02),  # NW
  c(-78.86, 36.02),  # NE
  c(-78.86, 35.96),  # SE
  c(-78.90, 35.96),  # SW
  c(-78.90, 36.02)
)))
cut_poly <- st_sfc(cut_poly, crs = 4326)
cut_poly <- st_transform(cut_poly, st_crs(roads_sel))
# The ZIP regions and roads can be cutoff to focus on the region of interest
zips_cut <- st_intersection(zips_sel, cut_poly)
roads_cut <- st_intersection(roads_sel, cut_poly)

ggplot() +
  geom_sf(data = zips_cut) +
  geom_sf(data = roads_cut, color = "black") +
  geom_sf(data = cut_poly, fill = NA, color = "red", linewidth = 1) +
  theme_minimal() +
  coord_sf(datum = NA)

```


The previous studies have observed the Cadmium concentrations in water and soil and did not find a significant correlation with the blood Cadmium levels. However, there were no measurements of Cadmium in the air and considering that the Durham county has quite a few industries, it is worth checking the EPA data for emissions in general.

```{r epa}

epa_df <- read_csv("C:/Users/amaan/Desktop/Project/EPA_2023_nc.csv", col_names = TRUE)

epa_durham <-
  epa_df |>
  rename(
    "Facility_Name" = "4. FACILITY NAME",
    "Street_Address" = "5. STREET ADDRESS",
    "City" = "6. CITY",
    "County" = "7. COUNTY",
    "ZIP" = "9. ZIP",
    "Latitude" = "12. LATITUDE",
    "Longitude" = "13. LONGITUDE",
    "Industry" = "23. INDUSTRY SECTOR",
    "Chemical" = "37. CHEMICAL",
    "Unit" = "50. UNIT OF MEASURE",
    "Fugitive_Air" = "51. 5.1 - FUGITIVE AIR",
    "Stack_Air" = "52. 5.2 - STACK AIR",
    "Water" = "53. 5.3 - WATER",
    "Underground" = "54. 5.4 - UNDERGROUND",
    "Total_On_Site" = "65. ON-SITE RELEASE TOTAL"
  ) |>
  filter(City == "DURHAM") |>
  arrange(desc(Total_On_Site)) |>
  select(
    Chemical,Facility_Name,
    Unit,Total_On_Site,Fugitive_Air,Stack_Air,Water,Underground,
    Industry,ZIP,Street_Address,Longitude,Latitude
    )
head(epa_durham,10)

# None of the emissions are Cadmium and Cadmium compounds

# However, it is still worth observing the emissions in the region of interest because it leads to air pollution and detrimental health.
# The measurements for all emissions are in pounds here which allows for easy comparison.
# The facilities mostly have emissions under stack air which means the emissions are released through controlled airways, but Brenntag Mid-South mostly has emissions under fugitive air which means the emissions are leaked unintentionally and possibly due to faulty equipment.
# No emissions are released into the water or underground which matches the findings from the study a decade ago when no significant associations were found between Cadmium blood levels and Cadmium concentrations in water and soil, and possibly demonstrates that the finding still holds in the present as no emissions are released into the water or underground. 

epa_zip <-
  epa |>
  group_by(ZIP) |>
  summarize(Count = n()) |>
  arrange(desc(Count))
epa_zip

epa_locations <-
  epa_durham |>
  group_by(Facility_Name,ZIP,Longitude,Latitude) |>
  summarize(Total_Emissions=sum(Total_On_Site),.groups="drop") |>
  arrange(desc(Total_Emissions)) |>
  filter(Total_Emissions > 100)
epa_locations

# The region of interest is partially in the ZIP region 27703. 
# The region has the most facilities and 3 of the facilities with the highest total emissions.

# Scale the data
#epa_scaled <- 
#  epa |>
#  mutate(across(c(Longitude,Latitude), scale))
# Geolocation Data: Latitude and longitude are a common example where you typically wouldn't scale the data, as their raw values and inherent spatial relationship (distance) are well-defined and meaningful in their original form.

# Select the data for clustering
epa_cluster <- 
  epa_locations |> 
  select(Longitude,Latitude)
# Create the plot to find a suitable k
#* The default for k.max is 10 so set it manually to 4 because the number of clusters must be less than the number of data points for a meaningful clustering.
fviz_nbclust(epa_cluster, kmeans, method = "wss", k.max = 4) +
  labs(title = "Elbow Method Plot")

# K-Means
fit <- kmeans(epa_cluster, centers = 3, iter.max = 50, nstart = 20)
epa_locations$Cluster <- fit$cluster

# Calculate the mean/centroids of each cluster for plotting
epa_k <-
  epa_locations |>
  group_by(Cluster) |>
  summarize(
    Longitude_Center = mean(Longitude),
    Latitude_Center = mean(Latitude)
  ) |>
  select(Cluster,Longitude_Center,Latitude_Center)
epa_k

# Create an sf object for plotting
epa_locations_sf <- st_as_sf(epa_k, coords = c("Longitude_Center", "Latitude_Center"), crs = 4269)
epa_locations_sf <- st_transform(epa_locations_sf,st_crs(cut_poly))
# Focus on the clusters in the region of interest
epa_point <- st_intersection(epa_locations_sf,cut_poly)

ggplot() +
  geom_sf(data = zips_cut) +
  geom_sf(data = roads_cut, color = "black") +
  geom_sf(data = cut_poly, fill = NA, color = "red", linewidth = 1) +
  geom_sf(data = epa_point, color = "red") +
  geom_sf_label(data = epa_point, aes(label = Cluster)) +
  theme_minimal() +
  coord_sf(datum = NA)
# The region of interest contains the center of the cluster of the top facilities in terms of emission. Though Cadmium and Cadmium compounds are not emitted by any facility, some of the other chemicals that are released or leaked have been linked with low birth weight in animals and are a cause for concern for pregnant individuals in general.

```

Assuming the subsidies are eligible for renewal.
```{r housing}

house_df <- read_csv("C:/Users/amaan/Desktop/Project/GIS/Durham_Subsidized_Housing_2014.csv", col_names = TRUE)

house <- 
  house_df |>
  separate(
    "Location 1", into = c("Street_Address","City_ZIP","Coordinates"), sep = "\n"
    ) |>
  separate(
    "Coordinates", into = c("Latitude","Longitude"), sep = ","
  ) |>
  mutate(
    across("Latitude", ~ str_remove_all(.x, "\\(")),
    across("Longitude", ~ str_remove_all(.x, "\\)")),
    across("City_ZIP", ~ str_sub(.x, 11))
    ) |>
  mutate(across(c("Longitude","Latitude"), ~ as.numeric(.x))) |>
  filter(`Owner Type` == "Non-Profit") |>
  select(-Street_Address)

# Create an sf object for plotting
house_sf <- st_as_sf(house, coords = c("Longitude", "Latitude"), crs = 4269)
house_sf <- st_transform(house_sf,st_crs(cut_poly))
# Focus on the clusters in the region of interest
house_points <- st_intersection(house_sf,cut_poly)

ggplot() +
  geom_sf(data = zips_cut) +
  geom_sf(data = roads_cut, color = "black") +
  geom_sf(data = cut_poly, fill = NA, color = "red", linewidth = 1) +
  geom_sf(data = epa_point, color = "red") +
  geom_sf(data = house_points, color = "brown") +
  theme_minimal() +
  coord_sf(datum = NA)

houses <-
  house |>
  filter(`Property Name` %in% house_points$`Property Name`)

# Select the data for clustering
houses_cluster <- 
  house |> 
  filter(`Property Name` %in% house_points$`Property Name`) |>
  select(Longitude,Latitude)
# Create the plot to find a suitable k
#* The default for k.max is 10 so set it manually to 7 because the number of clusters must be less than the number of data points for a meaningful clustering.
fviz_nbclust(houses_cluster, kmeans, method = "wss", k.max = 7) +
  labs(title = "Elbow Method Plot")

# K-Means
fit <- kmeans(houses_cluster, centers = 3, iter.max = 50, nstart = 20)
houses$Cluster <- fit$cluster

houses_n <-
  houses |>
  group_by(Cluster) |>
  summarize(Count = n())
houses_n

# Calculate the mean/centroid of each cluster for plotting
house_k <-
  houses |>
  group_by(Cluster) |>
  summarize(
    Longitude_Center = mean(Longitude),
    Latitude_Center = mean(Latitude)
  ) |>
  select(Cluster,Longitude_Center,Latitude_Center)
house_k

# Create an sf object for plotting
house_cluster_sf <- st_as_sf(house_k, coords = c("Longitude_Center", "Latitude_Center"), crs = 4269)
house_cluster_sf <- st_transform(house_cluster_sf,st_crs(cut_poly))

houses_point1 <-
  house_cluster_sf |>
  filter(Cluster == 1)

ggplot() +
  geom_sf(data = zips_cut) +
  geom_sf(data = roads_cut, color = "black") +
  geom_sf(data = cut_poly, fill = NA, color = "red", linewidth = 1) +
  geom_sf(data = epa_point, color = "red") +
  geom_sf(data = houses_point1, color = "brown") +
  geom_sf_label(data = houses_point1, aes(label = Cluster)) +
  theme_minimal() +
  coord_sf(datum = NA)

```


There was a study that explored the impact of a Mediterranean diet on blood Cadmium levels, and though there was no significant association with diet, the conclusion of the study was that diet is a factor that is still worth exploring. In any case then, it also helps to see if free food is available for the residents to possibly use it as places to distribute foods that can potentially affect blood Cadmium levels.
```{r food}

food_shp <- st_read("C:/Users/amaan/Desktop/Project/GIS/Food_Pantries/Food_Pantries.shp", quiet = TRUE)

food_shp <- st_transform(food_shp,32119)
foods <- 
  st_intersection(food_shp,cut_poly)
foods$name

ggplot() +
  geom_sf(data = zips_cut) +
  geom_sf(data = roads_cut, color = "black") +
  geom_sf(data = cut_poly, fill = NA, color = "red", linewidth = 1) +
  geom_sf(data = foods, color = "green") +
  theme_minimal() +
  coord_sf(datum = NA)
# The region of interest has 19 food pantries with the vast majority being churches.

```
```{r farms}

farm_shp <- st_read("C:/Users/amaan/Desktop/Project/GIS/Farmers_Markets/Farmers_Markets.shp", quiet = TRUE)

farm_shp <- st_transform(farm_shp,32119)
farms <- 
  st_intersection(farm_shp,cut_poly)

ggplot() +
  geom_sf(data = zips_cut) +
  geom_sf(data = roads_cut, color = "black") +
  geom_sf(data = cut_poly, fill = NA, color = "red", linewidth = 1) +
  geom_sf(data = farms, color = "green") +
  theme_minimal() +
  coord_sf(datum = NA)
# The region of interest has 2 farmers' markets.

```


3-30-300 Rule (for equitable access):
3: See at least three trees from your window.
30: Have 30% tree canopy cover in your neighborhood.
300: Live within 300 meters of a quality park or green space.
```{r parks}

park_shp <- st_read("C:/Users/amaan/Desktop/Project/GIS/Parks/Parks.shp", quiet = TRUE)

park_shp <- st_transform(park_shp,32119)
parks <- 
  st_intersection(park_shp,cut_poly)

parks_area <- sum(st_area(parks))
region_area <- st_area(cut_poly)
park_greenery <- (parks_area/region_area)*100
park_greenery

dists <- as.vector(st_distance(houses_point1,parks))
min_dist_park <- parks[which.min(dists),]
min_dist <- st_sf(geometry=st_nearest_points(houses_point1,min_dist_park))

ggplot() +
  geom_sf(data = zips_cut) +
  geom_sf(data = roads_cut, color = "black") +
  geom_sf(data = cut_poly, fill = NA, color = "red", linewidth = 1) +
  geom_sf(data = houses_point1, color = "red") +
  geom_sf(data = parks, fill = "green")
  theme_minimal() +
  coord_sf(datum = NA)
  
```
```{r tree}

tree_shp_file <- st_read("C:/Users/amaan/Desktop/Project/GIS/Trees_%26_Planting_Sites/Trees_%26_Planting_Sites.shp", quiet = TRUE)
tree_shp <-
  tree_shp_file |>
  filter(
    present == "Tree",
    neighborho %in% c("Downtown","Old East Durham","Other",NA)) |>
  select(
    OBJECTID,streetaddr,zipcode,facilityid,neighborho,
    genus,species,commonname,heightft,condition,
    vocs,pm10remove,pm25remove,polremoved,
    leafarea_s,
    geometry
    )
tree_shp <- st_transform(tree_shp,32119)

trees <- 
  st_intersection(tree_shp,cut_poly)

ggplot() +
  geom_sf(data = zips_cut) +
  geom_sf(data = roads_cut, color = "black") +
  geom_sf(data = cut_poly, fill = NA, color = "red", linewidth = 1) +
  geom_sf(data = houses_point1, color = "yellow") +
  geom_sf(data = trees, color = "green") +
  theme_minimal() +
  coord_sf(datum = NA)

houses_point1_buffer <- st_buffer(houses_point1,dist=1000)
trees_houses_point1 <- st_intersection(trees,houses_point1_buffer)

trees_houses_point1_area <- sum(trees_houses_point1$leafarea_s,na.rm=TRUE)
houses_point1_area <- st_area(houses_point1_buffer)*10.7639
tree_greenery <- (trees_houses_point1_area/houses_point1_area)*100
tree_greenery

```


```{r stop}



```

```{r route}

route_shp_file <- st_read("C:/Users/amaan/Desktop/Project/GIS/PublicTransit_Routes/GoDurham_Bus_Routes.shp",quiet = TRUE)

route_shp_file$line_name

route_shp <-
  route_shp_file |>
  separate(
    line_name, into = c("line_number"), sep = " "
  )
routes <- st_transform(route_shp,32119)
route3C <- routes |> filter(line_number == "3C")

ggplot() +
  geom_sf(data = zip_shp) +
  geom_sf(data = cut_poly, fill = NA, color = "red", linewidth = 1) +
  geom_sf(data = houses_point1, color = "yellow") +
  geom_sf(data = routes, color = "brown") +
  geom_sf(data = route3C, color = "green") +
  theme_minimal() +
  coord_sf(datum = NA)

```



